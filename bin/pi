#!/bin/bash -e

. $HOME/dotfiles/bin/dffunc

declare user=noyuno
declare domain=noyuno.space
declare domain2=noyuno.mydns.jp
declare mail=noyuno@$domain
declare pdata=/var/postgresql/data
declare showterm=/var/www/showterm
declare base=server
declare package=(
    oracle-java8-jdk nginx fcgiwrap postgresql \
        php php-pgsql php-gd php-fpm php-curl \
        rrdtool perl libwww-perl libmailtools-perl libmime-lite-perl \
        librrds-perl libdbi-perl libxml-simple-perl libhttp-server-simple-perl \
        libconfig-general-perl libio-socket-ssl-perl etckeeper jq)
declare certdomain="
        -d $domain
        -d dir.$domain
        -d git.$domain
        -d file.$domain
        -d files.$domain
        -d storage.$domain
        -d drive.$domain
        -d a.$domain
        -d b.$domain
        -d c.$domain
        -d d.$domain
        -d e.$domain
        -d f.$domain
        -d g.$domain
        -d h.$domain
        -d i.$domain
        -d j.$domain
        -d k.$domain
        -d l.$domain
        -d m.$domain
        -d n.$domain
        -d o.$domain
        -d p.$domain
        -d q.$domain
        -d r.$domain
        -d s.$domain
        -d t.$domain
        -d u.$domain
        -d v.$domain
        -d w.$domain
        -d x.$domain
        -d y.$domain
        -d z.$domain
        -d record.$domain
        -d status.$domain
        -d kanban.$domain
        -d bot.$domain 
        -d trash.$domain
        -d www.$domain
        -d blog.$domain
        -d mail.$domain
        -d dns.$domain
        "
declare usage=

. $HOME/dotfiles/$base/general.sh
. $HOME/dotfiles/$base/network.sh
. $HOME/dotfiles/$base/gitbucket.sh
. $HOME/dotfiles/$base/kanboard.sh
. $HOME/dotfiles/$base/localnet.sh
. $HOME/dotfiles/$base/netdata.sh
. $HOME/dotfiles/$base/nginx.sh
. $HOME/dotfiles/$base/anime.sh
. $HOME/dotfiles/$base/showterm.sh
. $HOME/dotfiles/$base/vuls.sh
. $HOME/dotfiles/$base/nodejs.sh
. $HOME/dotfiles/$base/python.sh
. $HOME/dotfiles/$base/jma.sh
. $HOME/dotfiles/$base/systemd.sh
. $HOME/dotfiles/$base/mail.sh
. $HOME/dotfiles/$base/slack.sh
. $HOME/dotfiles/$base/display.sh
. $HOME/dotfiles/$base/disk.sh
. $HOME/dotfiles/$base/owncloud.sh
. $HOME/dotfiles/$base/backup.sh
. $HOME/dotfiles/$base/pleroma.sh
. $HOME/dotfiles/$base/cert.sh

help()
{
    cat << EOF
pi: Raspberry Pi tools
$usage
EOF
    exit 1
}

if [ "$(lsb_release -is)" != "Raspbian" ]; then
    echo "this command is Raspbian only" 1>&2
    exit 1
fi

if [ $# -eq 0 ]; then
    help
fi

if [ "$1" = "install" ]; then
    ainstall
    motd
    timezone
    network
    ssl
    nginx
    psql
    gitbucket_psql
    kanboard_psql
    gitbucket
    gitbucket_nginx
    kanboard
    kanboard_nginx
    netdata
    netdata_conf
    netdata_nginx
    zeroconf
    pychromecast
    ddns
    anime
    showterm
    showterm_conf
    showterm_nginx
    cve
    vuls
else
    eval $*
fi

