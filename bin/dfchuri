#!/bin/bash -e

if [ $# -ne 5 ]; then
    name=${0##*/}
    {
    cat << EOF
$name: required 5 arguments: user email repo-raw sshgit httpsgit
example: $name noyuno noyuno@users.noreply.github.com \\
    https://raw.githubusercontent.com/noyuno/dotfiles/master \\
    ssh://git@github.com:noyuno/dotfiles.git \\
    https://github.com/noyuno/dotfiles.git
EOF
    }>&2
    exit 1
fi

user="$1"
email="$2"
reporaw="$3"
sshgit="$4"
httpsgit="$5"

sed -i -e 's|^REPO=.*$|REPO="'"$reporaw"'"|' ~/dotfiles/bin/dfhttps ~/dotfiles/bin/dfssh
sed -i -e 's|^sshgit=.*$|sshgit="'"$sshgit"'"|' ~/dotfiles/bin/dfgetdf 
sed -i -e 's|^httpsgit=.*$|httpsgit="'"$httpsgit"'"|' ~/dotfiles/bin/dfgetdf

sed -i -e 's|^ *git clone .* ~/dotfiles --depth 1|    git clone '"$sshgit"' ~/dotfiles --depth 1|' ~/dotfiles/readme.md
sed -i -e 's|^ *curl -sL .* \| bash|    curl -sL '"$reporaw"'/bin/dfhttps \| bash|' ~/dotfiles/readme.md
sed -i -e 's|^ *wget -qO - .* \| bash|    wget -qO - '"$reporaw"'/bin/dfhttps \| bash|' ~/dotfiles/readme.md

sed -i -e 's|^\s*name\s*=.*|    name = '"$user"'|' ~/dotfiles/.gitconfig
sed -i -e 's|^\s*email\s*=.*|    email = '"$email"'|' ~/dotfiles/.gitconfig
sed -i -e 's|^\s*user\s*=.*|    user = '"$user"'|' ~/dotfiles/.gitconfig


