#!/bin/bash -e

anime -n 1 --no-color | grep -e "ONAIR" -e "SOON" 1>/dev/null
i=0
title=$(anime -n 1 --no-color | awk -F\# '{ print $1 }' | \
    awk '{ for(i=4; i<NF; i++) { printf("%s%s", $i, OFS=" ") } print $NF }')
set +e
matched=0
a=""
while read line; do
    i=$((i+1))
    if [ "$line" ]; then
        echo "$title" | grep "$line" 1>/dev/null
        if [ $? -eq 0 ]; then
            matched=1
            break
        fi
    fi
done < ~/dotfiles/list/anime-keyword

set -e
if [ "$matched" -eq 1 ]; then
    words=$(head -n $i ~/dotfiles/list/anime-keyword | tail -n 1)
fi
h="$(echo $words | awk -F\# '{ print $2 }')"
if [ "$h" = "" ]; then
    h="$(echo $words | awk -F\# '{ print $1 }')"
    echo "hash not found. using $h"
else
    echo "hash found: #$h"
fi
rainbowstream -iot -tt "#$h"

