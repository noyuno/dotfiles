#!/bin/bash -e

base=$HOME/labo/svc
if [ "$1" ]; then
    today=$1
    todayf=${today:0:4}/${today:4:2}/${today:6:2}
else
    today=$(date +%Y%m%d)
    todayf=$(date +%Y/%m/%d)
fi

last=$(find $base -maxdepth 1 -type d | sed "s|^$base/||"|sort -n|tail -n 1)
lastf=$(date +%Y/%m/%d -d $last)

if [ ! -d $base ]; then
    echo "$base not found." >&2
fi

if [ ! -e $today ]; then
    cp -R $base/template $base/$today
fi

sed -i -e "s|TODAY|$todayf|g" -e "s|LAST|$lastf|g" "$base/$today/input.md"

cd $base/$today
exec $SHELL

