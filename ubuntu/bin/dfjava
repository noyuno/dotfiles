#!/bin/bash -e

. ~/dotfiles/bin/dffunc
require dfguiinstall

addapt ppa:webupd8team/java

dfx sudo debconf-set-selections '<<<' 'debconf shared/accepted-oracle-license-v1-1 select true'
dfx sudo debconf-set-selections '<<<' 'debconf shared/accepted-oracle-license-v1-1 seen true'
aptupdate
aptinstall oracle-java8-installer

targetdir="$HOME/Applications"

if [ "$JAVAIDE" == "eclipse" ]; then
    ecname="$DFTMP/eclipse.tar.gz"
    dfx curl '-sS' --max-time 1800 --retry 3 -L \
        "http://ftp.yz.yamagata-u.ac.jp/pub/eclipse//technology/epp/downloads/release/neon/2/eclipse-jee-neon-2-linux-gtk-x86_64.tar.gz" \
        -o "$ecname"
    dfx mkdir -p "$targetdir/"
    dfx tar --overwrite -xvf "$ecname" -C "$targetdir/"
    plname="$DFTMP/pleiades.zip"
    dfx curl -sS --max-time 1800 --retry 3 -L \
        "http://svn.osdn.jp/svnroot/mergedoc/trunk/Pleiades/build/pleiades.zip" \
        -o "$plname"
    dfx unzip -o -d "$DFTMP/pleiades" "$plname" 
    dfx cd "$DFTMP/pleiades"
    dfx cp -Rvf "features" "plugins" "$targetdir/eclipse/"
    dfx cp "$HOME/dotfiles/eclipse.ini" "$targetdir/eclipse/eclipse.ini"
    dfx sed -i.old "s|\$HOME|$HOME|g" "$targetdir/eclise/eclipse.ini"
    dfx mkdir -p "$HOME/bin"
    dfx ln -sfnv "$targetdir/eclipse/eclipse" "$HOME/bin/eclipse"
else
    dfout2 '$JAVAIDE=eclipse dfjava to install eclipse'
fi

finalize dfjava

